<UserControl x:Class="AVCNDB.WPF.Views.ToolsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:vm="clr-namespace:AVCNDB.WPF.ViewModels"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance Type=vm:ToolsViewModel}"
             d:DesignHeight="700" d:DesignWidth="1200">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- En-tête -->
        <Border Grid.Row="0" Padding="24,16" Background="{DynamicResource MaterialDesignPaper}">
            <StackPanel>
                <TextBlock Text="Outils" 
                           Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                           Foreground="{StaticResource PrimaryBrush}"/>
                <TextBlock Text="Outils utilitaires et fonctionnalités avancées" 
                           Style="{StaticResource MaterialDesignBody2TextBlock}"
                           Foreground="{DynamicResource MaterialDesignBodyLight}"
                           Margin="0,4,0,0"/>
            </StackPanel>
        </Border>

        <!-- Contenu - Grille d'outils -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <WrapPanel Margin="24" Orientation="Horizontal">
                
                <!-- Outil: Export Excel -->
                <materialDesign:Card Width="280" Margin="8" Padding="16">
                    <StackPanel>
                        <materialDesign:PackIcon Kind="FileExcel" 
                                                 Width="48" Height="48" 
                                                 Foreground="#217346"
                                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="Export Excel" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   HorizontalAlignment="Center"
                                   Margin="0,12,0,4"/>
                        <TextBlock Text="Exporter toutes les données médicaments vers un fichier Excel" 
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   TextAlignment="Center"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        <Button Command="{Binding ExportExcelCommand}" 
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,16,0,0"
                                HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Download" Width="18" Height="18" VerticalAlignment="Center"/>
                                <TextBlock Text="Exporter" Margin="8,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Outil: Import Excel -->
                <materialDesign:Card Width="280" Margin="8" Padding="16">
                    <StackPanel>
                        <materialDesign:PackIcon Kind="FileImport" 
                                                 Width="48" Height="48" 
                                                 Foreground="#217346"
                                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="Import Excel" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   HorizontalAlignment="Center"
                                   Margin="0,12,0,4"/>
                        <TextBlock Text="Importer des données médicaments depuis un fichier Excel" 
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   TextAlignment="Center"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        <Button Command="{Binding ImportExcelCommand}" 
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,16,0,0"
                                HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Upload" Width="18" Height="18" VerticalAlignment="Center"/>
                                <TextBlock Text="Importer" Margin="8,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Outil: Rapport PDF -->
                <materialDesign:Card Width="280" Margin="8" Padding="16">
                    <StackPanel>
                        <materialDesign:PackIcon Kind="FilePdfBox" 
                                                 Width="48" Height="48" 
                                                 Foreground="#E53935"
                                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="Rapport PDF" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   HorizontalAlignment="Center"
                                   Margin="0,12,0,4"/>
                        <TextBlock Text="Générer un rapport PDF complet de tous les médicaments" 
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   TextAlignment="Center"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        <Button Command="{Binding GeneratePdfCommand}" 
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,16,0,0"
                                HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="FilePdfBox" Width="18" Height="18" VerticalAlignment="Center"/>
                                <TextBlock Text="Générer" Margin="8,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Outil: Sauvegarde -->
                <materialDesign:Card Width="280" Margin="8" Padding="16">
                    <StackPanel>
                        <materialDesign:PackIcon Kind="DatabaseExport" 
                                                 Width="48" Height="48" 
                                                 Foreground="{StaticResource PrimaryBrush}"
                                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="Sauvegarde" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   HorizontalAlignment="Center"
                                   Margin="0,12,0,4"/>
                        <TextBlock Text="Créer une sauvegarde SQL de la base de données (mysqldump)" 
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   TextAlignment="Center"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        <TextBlock Text="{Binding LastBackupInfo}" 
                                   Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                   Foreground="{StaticResource SuccessBrush}"
                                   HorizontalAlignment="Center"
                                   Margin="0,4,0,0"/>
                        <Button Command="{Binding BackupDatabaseCommand}" 
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,12,0,0"
                                HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="DatabaseExport" Width="18" Height="18" VerticalAlignment="Center"/>
                                <TextBlock Text="Sauvegarder" Margin="8,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Outil: Restauration -->
                <materialDesign:Card Width="280" Margin="8" Padding="16">
                    <StackPanel>
                        <materialDesign:PackIcon Kind="DatabaseImport" 
                                                 Width="48" Height="48" 
                                                 Foreground="#FF9800"
                                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="Restauration" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   HorizontalAlignment="Center"
                                   Margin="0,12,0,4"/>
                        <TextBlock Text="Restaurer la base de données depuis une sauvegarde SQL" 
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   TextAlignment="Center"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        <Button Command="{Binding RestoreDatabaseCommand}" 
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,16,0,0"
                                HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="DatabaseImport" Width="18" Height="18" VerticalAlignment="Center"/>
                                <TextBlock Text="Restaurer" Margin="8,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Outil: Statistiques -->
                <materialDesign:Card Width="280" Margin="8" Padding="16">
                    <StackPanel>
                        <materialDesign:PackIcon Kind="ChartBar" 
                                                 Width="48" Height="48" 
                                                 Foreground="#9C27B0"
                                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="Statistiques" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   HorizontalAlignment="Center"
                                   Margin="0,12,0,4"/>
                        <TextBlock Text="Voir les statistiques de la base de données" 
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   TextAlignment="Center"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        <Button Command="{Binding ShowStatsCommand}" 
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,16,0,0"
                                HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="ChartBar" Width="18" Height="18" VerticalAlignment="Center"/>
                                <TextBlock Text="Voir" Margin="8,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>
                
            </WrapPanel>
        </ScrollViewer>

        <!-- Panneau statistiques (overlay) -->
        <Border Grid.Row="1"
                Background="#80000000"
                Visibility="{Binding ShowStats, Converter={StaticResource BoolToVis}}"
                MouseLeftButtonDown="StatsOverlay_MouseDown">
            <Border Background="{DynamicResource MaterialDesignPaper}"
                    CornerRadius="12"
                    Padding="32"
                    MaxWidth="500"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    MouseLeftButtonDown="StatsPanel_MouseDown">
                <StackPanel>
                    <TextBlock Text="Statistiques de la base de données"
                               Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                               Foreground="{StaticResource PrimaryBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Médicaments" VerticalAlignment="Center" Margin="0,6"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding TotalMedics}" FontWeight="Bold" FontSize="18" HorizontalAlignment="Right" Margin="20,6,0,6"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="DCI (Substances actives)" VerticalAlignment="Center" Margin="0,6"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding TotalDcis}" FontWeight="Bold" FontSize="18" HorizontalAlignment="Right" Margin="20,6,0,6"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Familles thérapeutiques" VerticalAlignment="Center" Margin="0,6"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding TotalFamilies}" FontWeight="Bold" FontSize="18" HorizontalAlignment="Right" Margin="20,6,0,6"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Laboratoires" VerticalAlignment="Center" Margin="0,6"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding TotalLabos}" FontWeight="Bold" FontSize="18" HorizontalAlignment="Right" Margin="20,6,0,6"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Formes pharmaceutiques" VerticalAlignment="Center" Margin="0,6"/>
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding TotalFormes}" FontWeight="Bold" FontSize="18" HorizontalAlignment="Right" Margin="20,6,0,6"/>

                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Voies d'administration" VerticalAlignment="Center" Margin="0,6"/>
                        <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding TotalVoies}" FontWeight="Bold" FontSize="18" HorizontalAlignment="Right" Margin="20,6,0,6"/>
                    </Grid>

                    <Button Content="Fermer"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            HorizontalAlignment="Center"
                            Margin="0,24,0,0"
                            Click="CloseStats_Click"/>
                </StackPanel>
            </Border>
        </Border>

        <!-- Loading indicator -->
        <ProgressBar Grid.Row="1"
                     IsIndeterminate="True"
                     Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"
                     VerticalAlignment="Top"
                     Margin="24,0"/>
    </Grid>
</UserControl>
